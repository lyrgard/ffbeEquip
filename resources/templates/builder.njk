{% extends "base.njk" %}

{% block stylesheet %}
<link rel="stylesheet" type="text/css" href="builder.css">
{% endblock %}

{% block script %}
<script src="builder/common.js"></script>
<script src="formula.js?version=8"></script>
<script src="builder/unitBuild.js"></script>
<script src="builder/dataStorage.js"></script>
<script src="builder/bestiary.js"></script>
<script src="builder/ennemyStats.js"></script>
<script src="builder/treeComparator.js"></script>
<script src="builder/itemTreeComparator.js"></script>
<script src="builder/esperTreeComparator.js"></script>
<script src="builder/buildOptimizer.js"></script>
<script src="builder/externalSites.js"></script>
<script src="builder/typeCombinationGenerator.js"></script>
<script src="builder.js?version=8"></script>
{% endblock %}

{% block body %}
<div class="col-xs-6">
    <div class="panel panel-default goal">
        <div class="panel-heading">
            <div id="normalGoalChoices">
                <form class="form-inline">
                    <div class="form-group flex-form-group">
                        <span>Goal : Maximize</span>
                        <select class="form-control">
                            <option value="physicalDamage">Physical damage</option>
                            <option value="magicalDamage">Magical damage</option>
                            <option value="hybridDamage">Hybrid damage</option>
                            <option value="jumpDamage">Jump damage</option>
                            <option value="physicaleHp">Physical eHP</option>
                            <option value="magicaleHp">Magical eHP</option>
                            <option value="def">Defense</option>
                            <option value="spr">Spirit</option>
                            <option value="hp">Health Points</option>
                            <option value="physicalEvasion">Physical evasion</option>
                            <option value="magicalEvasion">Magical evasion</option>
                            <option value="mpRefresh">MP/turn</option>
                            <option value="heal">Heal</option>
                        </select>
                        <span class="customGoalLinkSpan">or <a class="link" onclick="openCustomGoalModal()">Custom Goal</a></span>
                    </div>
                </form>
            </div>
            <div id="customGoalChoice" class="hidden">
                <span>Custom Goal: </span>
                <a id="customGoalFormula" class="link" onclick="openCustomGoalModal()"></a>
                <span class="link glyphicon glyphicon-remove" onclick="removeCustomGoal()" ></span>
            </div>
        </div>
    </div>
    <div class="panel panel-default unit">
        <div class="panel-heading">
            <form class="form-inline">
                <div class="form-group flex-form-group">
                    <span>Unit</span>
                    <select id="unitsSelect" name="units" class="form-control"></select>
                    <div class="unit-rarity">

                    </div>
                    <a id="unitLink" class="hidden" target="_blank">Unit info</a>
                </div>
            </form>
        </div>
        <div class="panel-body">
            <span class="unitEquipable weapons1">
            </span>
            <span class="unitEquipable weapons2">
            </span>
            <span class="unitEquipable armors">
            </span>
            <div class="unitStats">
                <div class="stat hp">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">HP</span>
                        <input type="text" class="form-control" placeholder="0" readonly/>
                    </div>
                    <div class="inputWithIcon pots">
                        <span class="leftIcon glyphicon glyphicon-plus" title="pots"></span>
                        <input type="text" class="form-control" placeholder="0" onkeypress="return isNumberOrMinus(event)"/>
                    </div>
                    <div class="inputWithIcon withPercent buff" style="visibility: hidden">
                        <span class="leftIcon glyphicon glyphicon-upload" title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0" onkeypress="return isNumberOrMinus(event)"/>
                    </div>
                </div>
                <div class="stat mp">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">MP</span>
                        <input type="text" class="form-control" placeholder="0" readonly/>
                    </div>
                    <div class="inputWithIcon pots">
                        <span class="leftIcon glyphicon glyphicon-plus" title="pots"></span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                    <div class="inputWithIcon withPercent buff " style="visibility: hidden">
                        <span class="leftIcon glyphicon glyphicon-upload" title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                </div>
                <div class="stat atk">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">ATK</span>
                        <input type="text" class="form-control" placeholder="0" readonly/>
                    </div>
                    <div class="inputWithIcon pots">
                        <span class="leftIcon glyphicon glyphicon-plus" title="pots"></span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                    <div class="inputWithIcon withPercent buff">
                        <span class="leftIcon glyphicon glyphicon-upload" title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                </div>
                <div class="stat mag">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">MAG</span>
                        <input type="text" class="form-control" placeholder="0" readonly/>
                    </div>
                    <div class="inputWithIcon pots">
                        <span class="leftIcon glyphicon glyphicon-plus" title="pots"></span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                    <div class="inputWithIcon withPercent buff">
                        <span class="leftIcon glyphicon glyphicon-upload" title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                </div>
                <div class="stat def">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">DEF</span>
                        <input type="text" class="form-control" placeholder="0" readonly/>
                    </div>
                    <div class="inputWithIcon pots">
                        <span class="leftIcon glyphicon glyphicon-plus" title="pots"></span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                    <div class="inputWithIcon withPercent buff">
                        <span class="leftIcon glyphicon glyphicon-upload" title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                </div>
                <div class="stat spr">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">SPR</span>
                        <input type="text" class="form-control" placeholder="0" readonly/>
                    </div>
                    <div class="inputWithIcon pots">
                        <span class="leftIcon glyphicon glyphicon-plus" title="pots"></span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                    <div class="inputWithIcon withPercent buff">
                        <span class="leftIcon glyphicon glyphicon-upload"  title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                </div>
                <div class="stat lbFillRate">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">LB gauge fill rate</span>
                        <input type="text" class="form-control"  readonly/>
                    </div>
                    <div class="inputWithIcon withPercent buff">
                        <span class="leftIcon glyphicon glyphicon-upload"  title="buff"></span>
                        <span class="rightIcon">%</span>
                        <input type="text" class="form-control" placeholder="0"/>
                    </div>
                </div>
                <div class="stat lbShardsPerTurn">
                    <div class="inputWithIcon baseStat">
                        <span class="leftIcon">Expected LB shards per turn</span>
                        <input type="text" class="form-control"  readonly/>
                    </div>
                    <div class="inputWithIcon buff">
                        <input type="text" class="form-control" placeholder="4"/>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 unitAttackElement">
                <div class="col-xs-3 text-right">Skill innate element(s):</div>
                <div class="col-xs-9 btn-group elements choice" data-toggle="buttons" id="elements"></div>
            </div>
            <div class="col-xs-12 magicalSkillType hidden">
                <div class="col-xs-3 text-right">Type of used attack:</div>
                <div class="col-xs-9">
                    <select class="form-control">
                        <option value="normal">Normal magical attack</option>
                        <option value="physicalMagic">Magic attack with physical mechanism</option>
                    </select>
                </div>
            </div>
            <div id="forceDoublehand" class="col-xs-12 checkboxGroup">
                <input type="checkbox"/><label>Force Doublehand build</label>
            </div>
            <div id="forceDualWield" class="col-xs-12 checkboxGroup">
                <input type="checkbox"/><label>Force Dual Wield build</label>
            </div>
            <div id="tryEquipsources" class="col-xs-12 checkboxGroup">
                <input type="checkbox"/><label>Try "Allow use of &lt;type&gt;" items</label>
            </div>
        </div>
    </div>
    <div class="panel panel-default monster">
        <div class="panel-heading">
            <span>Monster</span>
            <a id="monsterListLink" class="buttonLink hidden" onclick="showMonsterList();">Monster list</a>
        </div>
        <div class="panel-body">
            <div class="monsterDefensiveStats row">
                <div class="col-xs-6">
                    <div class = "input-group">
                        <span class = "input-group-addon">DEF</span>
                        <input id="monsterDef" type = "text" class = "form-control" placeholder = "100">
                    </div>
                </div>
                <div class="col-xs-6">
                    <div class = "input-group">
                        <span class = "input-group-addon">SPR</span>
                        <input id="monsterSpr" type = "text" class = "form-control" placeholder = "100">
                    </div>
                </div>
            </div>
            <div class="btn-group races choice" data-toggle="buttons" id="races">
            </div>
            <table id="elementalResists">
                <thead>
                    <tr>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/fire.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/ice.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/lightning.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/water.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/wind.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/earth.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/light.png"/></th>
                        <th><img class="miniIcon" src="img/heavyShield.png"><img src="img/dark.png"/></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="fire"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="ice"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="lightning"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="water"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="wind"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="earth"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="light"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                        <td class="dark"><input class="form-control" type="text" placeholder="0" onkeypress="return isNumberOrMinus(event)"/></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="panel panel-default equipments">
        <div class="panel-heading">
            <form class="form-inline">
                <div class="form-group flex-form-group">
                    <span>Equipments</span>
                    <select class="form-control">
                        <option value="all">All equipments</option>
                        <option value="owned" disabled>Only owned equipments</option>
                        <option value="shopRecipe">Only unlimited equipments (not event shop/recipe)</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="panel-body">
            <div class="checkboxGroup hidden"><input id="includeTMROfOwnedUnits" type="checkbox"><label>Include TMR of owned units not farmed yet</label></div>
            <div class="checkboxGroup hidden"><input id="includeTrialRewards" type="checkbox"><label>Include Trial rewards not acquired yet</label></div>
            <div class="checkboxGroup"><input id="exludeEvent" type="checkbox"><label>Exclude event items</label></div>
            <div class="checkboxGroup"><input id="excludePremium" type="checkbox"/><label>Exclude Premium items</label></div>
            <div class="checkboxGroup"><input id="excludeTMR5" type="checkbox"/><label>Exclude TMR of base 5* units</label></div>
            <div class="checkboxGroup" data-server="JP"><input id="excludeSTMR" type="checkbox"/><label>Exclude STMR</label></div>
            <div class="checkboxGroup"><input id="excludeNotReleasedYet" type="checkbox" checked="true"><label>Exclude not released yet equipments</label></div>
            <div><a class="link" onclick="showExcludedItems();"><span class="excludedItemNumber"></span> specifically excluded item(s)</a></div>
        </div>
    </div>
</div>
<div class="col-xs-6">
    <div id="buildDiv" class="hidden">
        <ul id="unitTabs" class="nav nav-tabs">
            <li class="active tab_0"><a href="#" onclick="selectUnitTab(0)">Select unit</a></li>
            <li id="addNewUnitButton" onclick="addNewUnit()"><a><span class="glyphicon glyphicon-plus"/></a></li>
        </ul>
        <div class="result-tab-pane">
            <div class="panel-body" style="padding:0;">
                <div id="pleaseSelectUnitMessage" class="hidden">Please select a unit</div>
                <div class="buildDiv">
                    <button id="buildButton" class="btn btn-primary">Build !</button>
                    <div id="buildProgressBar" class="progressBarDiv">
                        <div class="progressBar">0%</div>
                    </div>
                </div>
                <div id="resultStats" class="hidden row" >
                    <div class="col-xs-5 hp"><div class="col-xs-4 stat">HP</div><div class="col-xs-4 value text-right"></div><div class="col-xs-4 bonus text-right"></div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 mp"><div class="col-xs-4 stat">MP</div><div class="col-xs-4 value text-right"></div><div class="col-xs-4 bonus text-right"></div></div>
                    <div class="col-xs-5 atk"><div class="col-xs-4 stat">ATK</div><div class="col-xs-4 value text-right"></div><div class="col-xs-4 bonus text-right"></div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 def"><div class="col-xs-4 stat">DEF</div><div class="col-xs-4 value text-right"></div><div class="col-xs-4 bonus text-right"></div></div>
                    <div class="col-xs-5 mag"><div class="col-xs-4 stat">MAG</div><div class="col-xs-4 value text-right"></div><div class="col-xs-4 bonus text-right"></div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 spr"><div class="col-xs-4 stat">SPR</div><div class="col-xs-4 value text-right"></div><div class="col-xs-4 bonus text-right"></div></div>
                    <div class="col-xs-5 evade_physical"><div class="col-xs-7 stat" title="Physical Evade">P. Evade</div><div class="col-xs-5 text-right"><span class="value"></span>%</div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 evade_magical"><div class="col-xs-7 stat" title="Magical Evade">M. Evade</div><div class="col-xs-5 text-right"><span class="value"></span>%</div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 physicaleHp"><div class="col-xs-6 stat" title="Physical eHP : HP x DEF">P. eHP</div><div class="col-xs-6 value text-right"></div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 magicaleHp"><div class="col-xs-6 stat" title="Magical eHP : HP x SPR">M. eHP</div><div class="col-xs-6 value text-right"></div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 mpRefresh"><div class="col-xs-6 stat">MP/turn</div><div class="col-xs-6 text-right value"></div></div><div class="col-xs-1"></div>
                    <div class="col-xs-5 lbPerTurn"><div class="col-xs-6 stat">LB/turn</div><div class="col-xs-6 text-right value"></div></div><div class="col-xs-1"></div>
                    <div class="resists">
                        <div class="elements"></div>
                        <div class="ailments"></div>
                    </div>
                    <div class="resultLine physicalDamageResult hidden">Physical damage on a <span class="monsterDefValue"></span> DEF enemy with a <span class="damageCoef"></span> skill: <span class="calcValue"></span></div>
                    <div class="resultLine magicalDamageResult hidden">Magical damage on a <span class="monsterSprValue"></span> SPR enemy with a <span class="damageCoef"></span> skill: <span class="calcValue"></span></div>
                    <div class="resultLine hybridDamageResult hidden">Hybrid damage on a <span class="monsterDefValue"></span> DEF <span class="monsterSprValue"></span> SPR enemy with a <span class="damageCoef"></span> skill: <span class="calcValue"></span></div>
                    <div class="resultLine healingResult hidden">Healing coef: <span class="calcValue"></span></div>
                    <div class="resultLine buildResult hidden">Build goal calculated value: <span class="calcValue"></span></div>
                </div>
                <div class="buildLinks hidden">
                    <div id="detailedViewLink" class="col-xs-4 link">
                        <a onclick="switchView(false);"><span class="glyphicon glyphicon-zoom-in"></span> Detailed View</a>
                    </div>
                    <div id="conciseViewLink" class="col-xs-4 hidden link">
                        <a onclick="switchView(true);"><span class="glyphicon glyphicon-zoom-out"></span> Concise View</a>
                    </div>
                    <div class="col-xs-4">
                        <div class="dropdown">
                            <a class=" dropdown-toggle link" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-share-alt"></span> Share this build<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a class="buildLink link" onclick="showBuildLink()"><span class="glyphicon glyphicon-link"></span> FFBE Equip link</a></li>
                                <li><a class="buildAsText link" onclick="showBuildAsText()"><span class="glyphicon glyphicon-list"></span> Build as text</a></li>
                                <li data-server="GL"><a class="imageLink link" target="_blank"><span class="glyphicon glyphicon-camera"></span> Build image (using ffbe.piramidata.eu)</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xs-4">
                        <a class="builderSetupLink link" onclick="showBuilderSetupLink()"><span class="glyphicon glyphicon-wrench"></span> Share this builder setup</a>
                    </div>
                </div>
                <div id="buildResult" class="notSorted items results">
                    <div class="line">
                        <div class='buildLine buildLine_0'></div>
                        <div class='buildLine buildLine_1'></div>
                    </div>
                    <div class="line">
                        <div class='buildLine buildLine_2'></div>
                        <div class='buildLine buildLine_3'></div>
                    </div>
                    <div class="line">
                        <div class='buildLine buildLine_4'></div>
                        <div class='buildLine buildLine_5'></div>
                    </div>
                    <div class="line">
                        <div class='buildLine buildLine_6'></div>
                        <div class='buildLine buildLine_7'></div>
                    </div>
                    <div class="line">
                        <div class='buildLine buildLine_8'></div>
                        <div class='buildLine buildLine_9'></div>
                    </div>
                    <div class="line">
                        <div class='buildLine buildLine_10'></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="help">
        <h3>How to use this:</h3>
        <ol>
            <li>Select a unit you want to make a build for</li>
            <cd too
                li>If you want to make a build only using the items you own, make sure you're logged in, so that your inventory is loaded. Please note that your inventory cannot be imported, so you have to input and update it for accuracy.</li>
            <li>If you plan to use an attack with innate element(s), you can select the corresponding element(s) in the "Skill innate element(s)" section</li>
            <li>Fill information on the monster you're facing, its race(s) and its elemental resistance (negative number for elemental weakness). Take into account the elemental debufs you'll give it (for instance, if using Orlandeau's Divine Ruination, substract 50 to the light elemental resistance).</li>
            <li>Click on "Build !" button to start the computation</li>
        </ol>
    </div>
</div>

<div class="modal fade" id="fixItemModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">

                <input type="text" class="form-control" id="searchText">
                <div class="dropdown stat">
                    <img src="img/sort-a-z.png" class="dropdown-toggle statChoice" type="button" data-toggle="dropdown"/>
                    <div class="dropdown-menu">
                    </div>
                </div>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs type">
                </ul>
                <div id="results" class="table notSorted items results">
                    <div class="thead">
                        <div class="tr">
                            <div class="td type">&nbsp;</div>
                            <div class="td name">Name</div>
                            <div id="statTitle" class="td value sort">Value</div>
                            <div class="td special">Special</div>
                            <div class="td access">Access</div>
                            <div class="td inventory">Owned</div>
                        </div>
                    </div>
                    <div class="tbody">

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="customFormulaModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <span><b>Custom Formula</b></span>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="inputDiv input-group">
                    <span class="input-group-btn">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"><span class="caret"></span></button>
                            <ul class="dropdown-menu">
                                <li class="dropdown-submenu">
                                    <a class="test" tabindex="-1" href="#">Healing<span class="caret-right"></span></a>
                                    <ul class="dropdown-menu">
                                        <li><a tabindex="-1" href="#" onclick="addToCustomFormula('2500 + 9*SPR + 1.8*MAG')">Curaja</a></li>
                                        <li><a tabindex="-1" href="#" onclick="addToCustomFormula('1000 + 1.7*SPR + 0.34*MAG')">Curaga</a></li>
                                        <li><a tabindex="-1" href="#" onclick="addToCustomFormula('0.5*SPR + 0.1*MAG')">Base healing coef</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a class="test" tabindex="-1" href="#">Expeditions<span class="caret-right"></span></a>
                                    <ul class="dropdown-menu">
                                        <li class="dropdown-submenu">
                                            <a class="test" tabindex="-1" href="#">A Rank<span class="caret-right"></span></a>
                                            <ul class="dropdown-menu">
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('MP/55.1 + SPR/29.39')">General Hospitality</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('MP/55.1 + MAG/29.39')">Stranger Stuff</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2142 + MP/53.55 + MAG/85.68 + SPR/85.68')">He Who Smelt It</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2164 + MP/54.1 + SPR/43.28')">Full House</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('MP/108.2 + ATK/43.28 + MAG/43.28')">A Beast's Bounty</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/1082 + ATK/43.28 + DEF/86.56')">Child's Play</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2172 + MP/108.6 + ATK/86.88 + DEF/86.88 + MAG/86.88')">A Priest, a Monk, and a Paladin</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('MP/54.1 + MAG/86.56 + SPR/43.28')">Shopping for Medicine</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2142 + MP/107.1 + MAG/42.84 + SPR/85.68')">The Missing Key</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2142 + MP/53.55 + MAG/85.68 + SPR/85.68')">Across the Desert</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2389 + MP/119.45 + ATK/95.56 + MAG/47.78 + SPR/95.56')">Cook Off</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2429 + MP/121.45 + ATK/97.16 + DEF/97.16 + MAG/97.16 + SPR/97.16')">Tavern Cleanup</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2389 + ATK/47.78 + DEF/95.56 + MAG/95.56 + SPR/95.56')">Too Many Coeurls</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/1190 + ATK/95.2 + DEF/47.6 + SPR/95.2')">Lost in the Dark</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2389 + MP/119.45 + DEF/95.56 + MAG/95.56 + SPR/47.78')">Anger Management</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2389 + MP/119.45 + DEF/95.56 + MAG/47.78 + SPR/95.56')">Wrath in the Wreckage</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/1190 + MP/59.5 + DEF/95.2 + SPR/95.2')">Seven Years Bad Luck</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2389 + MP/119.45 + DEF/95.56 + MAG/95.56 + SPR/47.78')">Ghost Busted</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2389 + MP/119.45 + DEF/95.56 + MAG/47.78 + SPR/95.56')">What's Her Secret?</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/1190 + MP/59.5 + DEF/95.2 + SPR/95.2')">Braving the Elements</a></li>
                                            </ul>
                                        </li>
                                        <li class="dropdown-submenu">
                                            <a class="test" tabindex="-1" href="#">S Rank<span class="caret-right"></span></a>
                                            <ul class="dropdown-menu">
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2298 + MP/229.8 + ATK/91.92 + DEF/91.92')">Lost in the World</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4447 + MP/222.35 + ATK/59.29 + DEF/177.88 + SPR/177.88')">Hotline Grandshelt</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4596 + MP/114.9 + MAG/91.92 + SPR/91.92')">Break Time</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4575 + MP/228.75 + ATK/91.5 + DEF/91.5 + SPR/183')">Reinventing the Wheel</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('MP/114.9 + DEF/183.84 + MAG/91.92 + SPR/91.92')">Winter is Coming</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4447 + MP/222.35 + ATK/59.29 + DEF/177.88 + SPR/177.88')">Hide your wallets!</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4575 + MP/114.38 + ATK/183 + MAG/91.5 + SPR/183')">Paper, Please!</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/2298 + MP/229.8 + ATK/91.92 + DEF/91.92')">Wherefore Art Thou, Father</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4447 + MP/222.35 + ATK/59.29 + DEF/177.88 + SPR/177.88')">A "Legendary" Challenge</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4596 + MP/114.9 + MAG/91.92 + SPR/91.92')">Where's My Mommy?</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4575 + MP/228.75 + ATK/91.5 + DEF/91.5 + SPR/183')">Be the Best</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('MP/114.9 + DEF/183.84 + MAG/91.92 + SPR/91.92')">Hot Ice</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4447 + MP/222.35 + ATK/59.29 + DEF/177.88 + SPR/177.88')">Save the Children</a></li>
                                                <li><a tabindex="-1" href="#" onclick="addToCustomFormula('HP/4575 + MP/114.38 + ATK/183 + MAG/91.5 + SPR/183')">Magi in Danger</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </span>
                    <input type="text" class="form-control" id="formulaInput" placeholder="Enter formula (for instance, HP * DEF)">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" onclick="chooseCustomFormula()">OK</button>
                    </span>
                </div>
                <h4>How to use this:</h4>
                <ul>
                    <li>A formula contains 1 or more <span class="code">EXPRESSION</span>, seprated by semicolons <span class="code">;</span> (without semicolon after the last one)</li>
                    <li>The first <span class="code">EXPRESSION</span> is used to note a stat to maximize in order to be able to compare builds. It can use one or more <span class="code">VARIABLES</span> with the multiply <span class="code">*</span>, divide <span class="code">/</span> or add <span class="code">+</span> operators between them</li>
                    <li>Any <span class="code">EXPRESSION</span> after the first is a <span class="code">CONDITION</span>. <span class="code">CONDITION</span> must be in the form <span class="code">VARIABLE > VALUE</span>, for instance : <span class="code">HP > 6000</span>. The exceptions to this rule are the short-cuts, starting with <span class="code">I</span> (like <span class="code">I_CONFUSION</span>), which are translated into <span class="code">VARIABLE > VALUE</span> form</li>
                    <li>
                        <h5>Some valid formula :</h5>
                        <div class="tokenList">
                            <table class="table">
                                <tbody>
                                    <tr><td class="token"><span class="code">HP</span></td><td>Maximize HP</td></tr>
                                    <tr><td class="token"><span class="code">DEF * HP</span></td><td>Maximize the product of HP by DEF (physical eHP)</td></tr>
                                    <tr><td class="token"><span class="code">SPR * HP</span></td><td>Maximize the product of HP by SPR (magical eHP)</td></tr>
                                    <tr><td class="token"><span class="code">MP * MP_REFRESH</span></td><td>Maximize the number of MP regained each turn</td></tr>
                                    <tr><td class="token"><span class="code">M_DAMAGE; HP > 6000</span></td><td>Maximize Magical Damage while keeping HP > 6000</td></tr>
                                    <tr><td class="token"><span class="code">P_DAMAGE; P_EVADE > 100; HP > 5000</span></td><td>Maximize Physical Damage while reaching 100% physical evade and HP > 5000</td></tr>
                                    <tr><td class="token"><span class="code">P_DAMAGE; I_PHYSICAL; HP > 5000</span></td><td>Maximize Physical Damage while reaching 100% physical evade and HP > 5000</td></tr>
                                    <tr><td class="token"><span class="code">HP; LB > 12</span></td><td>Maximize HP while insuring at least 12 LB points per turn</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li><span class="glyphicon glyphicon-warning-sign"></span> The more different variables you use in your formula, the more time the calculations will take</li>
                    <li>
                        <h5>Available variables :</h5>
                        <div class="tokenList">
                            <table class="table">
                                <tbody>
                                    <tr><td class="token">HP, MP, ATK, DEF, MAG, SPR</td><td>Value of the corresponding basic stat</td></tr>
                                    <tr><td class="token">MP_REFRESH</td><td>% of MP refresh per turn</td></tr>
                                    <tr><td class="token">P_DAMAGE</td><td>This is the total physical damage, taking into account the ATK, the elements, the killers, the damage variance, ...</td></tr>
                                    <tr><td class="token">M_DAMAGE</td><td>Same as P_DAMAGE but for magical damage</td></tr>
                                    <tr><td class="token">H_DAMAGE</td><td>Same as P_DAMAGE but for hybrid damage</td></tr>
                                    <tr><td class="token">J_DAMAGE</td><td>Same as J_DAMAGE but for jump damage</td></tr>
                                    <tr><td class="token">M_P_DAMAGE</td><td>Same as P_DAMAGE but for magical damage with physical mechanism</td></tr>
                                    <tr><td class="token">P_EVADE</td><td>Physical evade</td></tr>
                                    <tr><td class="token">I_PHYSICAL</td><td>Immunity to physical attacks. This is a shortcut to P_EVADE > 100</td></tr>
                                    <tr><td class="token">M_EVADE</td><td>Magical evade</td></tr>
                                    <tr><td class="token">LB</td><td>Number of LB point generated each turn. Note that this number is heavilly dependant on the expected number of LB shards gained per turn.</td></tr>
                                    <tr><td class="token">R_FIRE, R_ICE, R_THUNDER, R_WATER, R_EARTH, R_WIND, R_LIGHT, R_DARK</td><td>Corresponding elemental resistance</td></tr>
                                    <tr><td class="token">R_POISON, R_BLIND, R_SLEEP, R_SILENCE, R_PARALYSIS, R_CONFUSION, R_DISEASE, R_PETRIFICATION, R_DEATH</td><td>Corresponding ailment resistance</td></tr>
                                    <tr><td class="token">I_POISON, I_BLIND, I_SLEEP, I_SILENCE, I_PARALYSIS, I_CONFUSION, I_DISEASE, I_PETRIFICATION, I_DEATH</td><td>Corresponding ailment immunity. I_XXX is a shortcut for R_XXX > 100</td></tr>
                                    <tr><td class="token">I_AILMENTS</td><td>Immunity to all ailments. This condition is a shortcut for all R_&lt;ailment&gt; > 100</td></tr>
                                    <tr><td class="token">I_DISABLE</td><td>Immunity to all disabling ailments. This condition is a shortcut for I_SLEEP; I_PARALYSIS; I_CONFUSION; I_PETRIFICATION</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
